{% extends 'layout.html' %}

{% block head_title %}{{ post.title }}{% endblock %}

{% block content %}
<h2>{{ post.title }}</h2>
<p class="text-muted">
    Por <strong>{{ post.author.username }}</strong> |
    {{ post.created_at.strftime('%d/%m/%Y %H:%M') }}
    {% if post.category %}
        | Categoría: <span class="badge badge-info">{{ post.category.name }}</span>
    {% endif %}
</p>

<div class="mb-4">
    <p>{{ post.content }}</p>
</div>

<hr>
<h4>Comentarios ({{ post.comments|length }})</h4>

{% if current_user.is_authenticated %}
<form method="POST">
    {{ form.hidden_tag() }}
    <div class="form-group">
        {{ form.content.label(class="form-label") }}
        {{ form.content(class="form-control", rows="3", placeholder="Escribe un comentario...") }}
        {% for error in form.content.errors %}
            <div class="text-danger">{{ error }}</div>
        {% endfor %}
    </div>
    <button type="submit" class="btn btn-primary mt-2">Comentar</button>
</form>
{% else %}
<p><a href="{{ url_for('login') }}">Inicia sesión</a> para comentar.</p>
{% endif %}

<ul class="list-group mt-4">
    {% for comment in post.comments %}
        <li class="list-group-item">
            <strong>{{ comment.author.username }}</strong> 
            <small class="text-muted">el {{ comment.created_at.strftime('%d/%m/%Y %H:%M') }}</small>
            <p class="mb-0">{{ comment.content }}</p>
        </li>
    {% endfor %}
</ul>
{% endblock %}
